<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Ms::Msrun [RDoc Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          Ms::Msrun
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../files/lib/ms/msrun/nokogiri_rb.html">lib/ms/msrun/nokogiri.rb</a>
          </li>
          <li class='other'>
            <a href="../../files/lib/ms/msrun/regexp/mzxml_rb.html">lib/ms/msrun/regexp/mzxml.rb</a>
          </li>
          <li class='other'>
            <a href="../../files/lib/ms/msrun/index_rb.html">lib/ms/msrun/index.rb</a>
          </li>
          <li class='other'>
            <a href="../../files/lib/ms/msrun/sha1_rb.html">lib/ms/msrun/sha1.rb</a>
          </li>
          <li class='other'>
            <a href="../../files/lib/ms/msrun/axml/mzxml_rb.html">lib/ms/msrun/axml/mzxml.rb</a>
          </li>
          <li class='other'>
            <a href="../../files/lib/ms/msrun/search_rb.html">lib/ms/msrun/search.rb</a>
          </li>
          <li class='other'>
            <a href="../../files/lib/ms/msrun_rb.html">lib/ms/msrun.rb</a>
          </li>
          <li>
            <a class='show' href='#' onclick='this.parentNode.parentNode.className += " expanded"; this.parentNode.removeChild(this); return false'>show all</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong>Object</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000046">add_parent_scan</a></li>
              <li><a href="#M000047">filetype_and_version</a></li>
              <li><a href="#M000036">foreach</a></li>
              <li><a href="#M000045">get_parser</a></li>
              <li><a href="#M000032">new</a></li>
              <li><a href="#M000031">open</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000035">each</a></li>
              <li><a href="#M000034">each_scan</a></li>
              <li><a href="#M000043">first</a></li>
              <li><a href="#M000044">last</a></li>
              <li><a href="#M000037">ms_level</a></li>
              <li><a href="#M000033">parent_basename_noext</a></li>
              <li><a href="#M000038">scan</a></li>
              <li><a href="#M000040">scan_count</a></li>
              <li><a href="#M000039">scan_counts</a></li>
              <li><a href="#M000041">start_and_end_mz</a></li>
              <li><a href="#M000042">start_and_end_mz_brute_force</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='includes'>
              <h2>Included modules</h2>
              <ol>
                <li><a href="Msrun/Search.html">Search</a></li>
                <li>Enumerable</li>
              </ol>
            </div>
          </div>
          <div id='section'>
            <div id='class-list'>
              <h2>Classes and Modules</h2>
              Module <a href="Msrun/Axml.html" class="link">Ms::Msrun::Axml</a><br />
              Module <a href="Msrun/Nokogiri.html" class="link">Ms::Msrun::Nokogiri</a><br />
              Module <a href="Msrun/Regexp.html" class="link">Ms::Msrun::Regexp</a><br />
              Module <a href="Msrun/Search.html" class="link">Ms::Msrun::Search</a><br />
              Module <a href="Msrun/Sha1.html" class="link">Ms::Msrun::Sha1</a><br />
              Class <a href="Msrun/Index.html" class="link">Ms::Msrun::Index</a><br />
            </div>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DEFAULT_PARSER</td>
                    <td>=</td>
                    <td class='context-item-value'>'nokogiri'</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      DEFAULT_PARSER = &#8216;axml&#8217; DEFAULT_PARSER = &#8216;regexp&#8217;
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>Mzxml_regexp</td>
                    <td>=</td>
                    <td class='context-item-value'>/http:\/\/sashimi.sourceforge.net\/schema(_revision)?\/([\w\d_\.]+)/o</td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>Mzdata_regexp</td>
                    <td>=</td>
                    <td class='context-item-value'>/&lt;mzData.*version=&quot;([\d\.]+)&quot;/m</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      &#8216;<a
                      href="http://sashimi.sourceforge.net/schema/MsXML.xsd">sashimi.sourceforge.net/schema/MsXML.xsd</a>&#8217;
                      # version 1 &#8216;<a
                      href="http://sashimi.sourceforge.net/schema_revision/mzXML_X.X">sashimi.sourceforge.net/schema_revision/mzXML_X.X</a>&#8217;
                      # others
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>Raw_header_unpack_code</td>
                    <td>=</td>
                    <td class='context-item-value'>'@2axaxaxaxaxaxaxa'</td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>Mzml_regexp</td>
                    <td>=</td>
                    <td class='context-item-value'>/http:\/\/psi.hupo.org\/schema_revision\/mzML_([\w\d\.]+)/o</td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>end_time</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      the retention time in seconds of the last scan (regardless of any meta-data
                      written in the header)
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>filename</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      the string passed in to open the file for reading
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>filetype</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      The filetype. Valid types (for parsing) are:
                      
                      <pre>:mzxml&#x000A;:mzdata&#x000A;:mzml</pre>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>index</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      an array of doublets, [start_byte, length] for each scan element
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>parent_basename</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      The basename of the parent file listed (e.g., a .RAW file). Note that in v1
                      mzXML this will be *.mzXML while in later versions it&#8217;s *.RAW. See <a
                      href="Msrun.html#M000033">parent_basename_noext</a> for more robust value
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>parent_location</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      The location of the parent file (e.g., a .RAW file). In version mzXML v1
                      this will be nil.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>parser</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      holds the class that parses the file
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>scan_count</td>
                    <td class='context-item-value'>[W]</td>
                    <td class='context-item-desc'>
                      
                      the total number of scans
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>scan_nums</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      an array holding the scan numbers found in the run
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>start_time</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      the retention time in seconds of the first scan (regardless of any
                      meta-data written in the header)
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>version</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'>
                      
                      The version string of this type of file
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='method public-class' id='method-M000046'>
                <a name='M000046'></a>
                <div class='synopsis'>
                  <span class='name'>add_parent_scan</span>
                  <span class='arguments'>(scans, add_intensities=false)</span>
                </div>
                <div class='description'>
                  <p>
                  only adds the parent if one is not already present!
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000046-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000046-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 209</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_parent_scan</span>(<span class="ruby-identifier">scans</span>, <span class="ruby-identifier">add_intensities</span>=<span class="ruby-keyword kw">false</span>)&#x000A;    <span class="ruby-identifier">prev_scan</span> = <span class="ruby-keyword kw">nil</span>&#x000A;    <span class="ruby-identifier">parent_stack</span> = [<span class="ruby-keyword kw">nil</span>]&#x000A;    <span class="ruby-comment cmt">## we want to set the level to be the first mslevel we come to</span>&#x000A;    <span class="ruby-identifier">prev_level</span> = <span class="ruby-identifier">scans</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">ms_level</span>&#x000A;    <span class="ruby-identifier">scans</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">scan</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-comment cmt">#next unless scan  ## the first one is nil, (others?)</span>&#x000A;      <span class="ruby-identifier">level</span> = <span class="ruby-identifier">scan</span>.<span class="ruby-identifier">ms_level</span>&#x000A;      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prev_level</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">level</span>&#x000A;        <span class="ruby-identifier">parent_stack</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-identifier">prev_scan</span>&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prev_level</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">level</span>&#x000A;        (<span class="ruby-identifier">prev_level</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">level</span>).<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-identifier">parent_stack</span>.<span class="ruby-identifier">shift</span> <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scan</span>.<span class="ruby-identifier">ms_level</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>&#x000A;        <span class="ruby-identifier">precursor</span> = <span class="ruby-identifier">scan</span>.<span class="ruby-identifier">precursor</span>&#x000A;        <span class="ruby-comment cmt">#precursor.parent = parent_stack.first  # that's the next line's</span>&#x000A;        <span class="ruby-identifier">precursor</span>[<span class="ruby-value">2</span>] = <span class="ruby-identifier">parent_stack</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">precursor</span>[<span class="ruby-value">2</span>]&#x000A;        <span class="ruby-comment cmt">#precursor.intensity</span>&#x000A;        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">add_intensities</span>&#x000A;          <span class="ruby-identifier">precursor</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">precursor</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">spectrum</span>.<span class="ruby-identifier">intensity_at_mz</span>(<span class="ruby-identifier">precursor</span>[<span class="ruby-value">0</span>])&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-identifier">prev_level</span> = <span class="ruby-identifier">level</span>&#x000A;      <span class="ruby-identifier">prev_scan</span> = <span class="ruby-identifier">scan</span>&#x000A;    <span class="ruby-keyword kw">end</span>&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000047'>
                <a name='M000047'></a>
                <div class='synopsis'>
                  <span class='name'>filetype_and_version</span>
                  <span class='arguments'>(file_or_io)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000047-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000047-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 245</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filetype_and_version</span>(<span class="ruby-identifier">file_or_io</span>)&#x000A;    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file_or_io</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">IO</span>&#x000A;      <span class="ruby-identifier">io</span> = <span class="ruby-identifier">file_or_io</span>&#x000A;      <span class="ruby-identifier">found</span> = <span class="ruby-keyword kw">nil</span>&#x000A;      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">rewind</span>&#x000A;      <span class="ruby-comment cmt"># Test for RAW file:</span>&#x000A;      <span class="ruby-identifier">header</span> = <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">18</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-constant">Raw_header_unpack_code</span>).<span class="ruby-identifier">join</span>&#x000A;      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">header</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Finnigan'</span>&#x000A;        <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">:raw</span>, <span class="ruby-keyword kw">nil</span>]&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">rewind</span>&#x000A;      <span class="ruby-keyword kw">while</span> (<span class="ruby-identifier">line</span> = <span class="ruby-identifier">io</span>.<span class="ruby-identifier">gets</span>)&#x000A;        <span class="ruby-identifier">found</span> = &#x000A;          <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">line</span>&#x000A;          <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Mzml_regexp</span>&#x000A;            [<span class="ruby-identifier">:mzml</span>, <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">dup</span>]&#x000A;          <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Mzxml_regexp</span>&#x000A;            <span class="ruby-identifier">mtch</span> = <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">dup</span>&#x000A;            <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">mtch</span>&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/mzXML_([\d\.]+)/</span>&#x000A;              [<span class="ruby-identifier">:mzxml</span>, <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">dup</span>]&#x000A;            <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/MsXML/</span>&#x000A;              [<span class="ruby-identifier">:mzxml</span>, <span class="ruby-value str">'1.0'</span>]&#x000A;            <span class="ruby-keyword kw">else</span>&#x000A;              <span class="ruby-identifier">abort</span> <span class="ruby-value str">&quot;Cannot determine mzXML version!&quot;</span>&#x000A;            <span class="ruby-keyword kw">end</span>&#x000A;          <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Mzdata_regexp</span>&#x000A;            [<span class="ruby-identifier">:mzdata</span>, <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">dup</span>]&#x000A;          <span class="ruby-keyword kw">end</span>&#x000A;        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">found</span>&#x000A;          <span class="ruby-keyword kw">break</span>&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">rewind</span>&#x000A;      <span class="ruby-identifier">found</span>&#x000A;    <span class="ruby-keyword kw">else</span>&#x000A;      <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file_or_io</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>&#x000A;        <span class="ruby-identifier">filetype_and_version</span>(<span class="ruby-identifier">io</span>)&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;    <span class="ruby-keyword kw">end</span>&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000036'>
                <a name='M000036'></a>
                <div class='synopsis'>
                  <span class='name'>foreach</span>
                  <span class='arguments'>(filename, parse_opts={}, &amp;block)</span>
                </div>
                <div class='description'>
                  <p>
                  opens the file and yields each scan in the block see <a
                  href="Msrun.html#M000034">each_scan</a> for parsing options
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000036-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000036-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 105</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">foreach</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">parse_opts</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;    <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">each_scan</span>(<span class="ruby-identifier">parse_opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;    <span class="ruby-keyword kw">end</span>&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000045'>
                <a name='M000045'></a>
                <div class='synopsis'>
                  <span class='name'>get_parser</span>
                  <span class='arguments'>(filetype, version)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000045-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000045-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 197</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_parser</span>(<span class="ruby-identifier">filetype</span>, <span class="ruby-identifier">version</span>)&#x000A;    <span class="ruby-identifier">require</span> <span class="ruby-node">&quot;ms/msrun/#{DEFAULT_PARSER}/#{filetype}&quot;</span>&#x000A;    <span class="ruby-identifier">parser_class</span> = <span class="ruby-identifier">filetype</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">capitalize</span>&#x000A;    <span class="ruby-identifier">base_class</span> = <span class="ruby-constant">Ms</span><span class="ruby-operator">::</span><span class="ruby-constant">Msrun</span>.<span class="ruby-identifier">const_get</span>( <span class="ruby-constant">DEFAULT_PARSER</span>.<span class="ruby-identifier">capitalize</span> )&#x000A;    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">const_defined?</span> <span class="ruby-identifier">parser_class</span>&#x000A;      <span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">const_get</span> <span class="ruby-identifier">parser_class</span>&#x000A;    <span class="ruby-keyword kw">else</span>&#x000A;      <span class="ruby-identifier">raise</span> <span class="ruby-constant">RuntimeError</span>, <span class="ruby-node">&quot;no class #{base_class}::#{parser_class}&quot;</span>&#x000A;    <span class="ruby-keyword kw">end</span>&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000032'>
                <a name='M000032'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(io, filename=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  takes an io object. The preferred way to access <a
                  href="Msrun.html">Msrun</a> objects is through the open method since it
                  ensures that the io object will be available for the lazy evaluation of
                  spectra.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000032-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000032-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 63</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">filename</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;    <span class="ruby-ivar">@scan_counts</span> = <span class="ruby-keyword kw">nil</span>&#x000A;    <span class="ruby-ivar">@filename</span> = <span class="ruby-identifier">filename</span>&#x000A;    <span class="ruby-ivar">@filetype</span>, <span class="ruby-ivar">@version</span> = <span class="ruby-constant">Ms</span><span class="ruby-operator">::</span><span class="ruby-constant">Msrun</span>.<span class="ruby-identifier">filetype_and_version</span>(<span class="ruby-identifier">io</span>)&#x000A;    <span class="ruby-identifier">parser_klass</span> = <span class="ruby-constant">Ms</span><span class="ruby-operator">::</span><span class="ruby-constant">Msrun</span>.<span class="ruby-identifier">get_parser</span>(<span class="ruby-ivar">@filetype</span>, <span class="ruby-ivar">@version</span>)&#x000A;&#x000A;    <span class="ruby-ivar">@parser</span> = <span class="ruby-identifier">parser_klass</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">io</span>, <span class="ruby-ivar">@version</span>)&#x000A;    <span class="ruby-ivar">@index</span> = <span class="ruby-constant">Ms</span><span class="ruby-operator">::</span><span class="ruby-constant">Msrun</span><span class="ruby-operator">::</span><span class="ruby-constant">Index</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">io</span>)&#x000A;    <span class="ruby-ivar">@scan_nums</span> = <span class="ruby-ivar">@index</span>.<span class="ruby-identifier">scan_nums</span>&#x000A;    <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">parse_header</span>(<span class="ruby-ivar">@index</span>.<span class="ruby-identifier">header_length</span>)&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000031'>
                <a name='M000031'></a>
                <div class='synopsis'>
                  <span class='name'>open</span>
                  <span class='arguments'>(filename, &amp;block)</span>
                </div>
                <div class='description'>
                  <p>
                  Opens the filename
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000031-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000031-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 56</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;    <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">filename</span>) ) }&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000035'>
                <a name='M000035'></a>
                <div class='synopsis'>
                  <span class='name'>each</span>
                  <span class='arguments'>(parse_opts={}, &amp;block)</span>
                </div>
                <div class='description'>
                  <p>
                  Alias for <a href="Msrun.html#M000034">each_scan</a>
                  </p>
                </div>
              </div>
              <div class='method public-instance' id='method-M000034'>
                <a name='M000034'></a>
                <div class='synopsis'>
                  <span class='name'>each_scan</span>
                  <span class='arguments'>(parse_opts={}, &amp;block)</span>
                </div>
                <div class='description'>
                  <p>
                  returns each scan options:
                  </p>
                  <pre>:spectrum =&gt; true | false (default is true)&#x000A;:precursor =&gt; true | false (default is true)&#x000A;:ms_level =&gt; Integer or Array return only scans of that level&#x000A;:reverse =&gt; true | false (default is false) goes backwards</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000034-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000034-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 85</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_scan</span>(<span class="ruby-identifier">parse_opts</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;    <span class="ruby-identifier">ms_levels</span> = &#x000A;      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">msl</span> = <span class="ruby-identifier">parse_opts</span>[<span class="ruby-identifier">:ms_level</span>]&#x000A;        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">msl</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>) ; [<span class="ruby-identifier">msl</span>]&#x000A;        <span class="ruby-keyword kw">else</span> ; <span class="ruby-identifier">msl</span>  &#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;    <span class="ruby-identifier">snums</span> = <span class="ruby-ivar">@index</span>.<span class="ruby-identifier">scan_nums</span>&#x000A;    <span class="ruby-identifier">snums</span> = <span class="ruby-identifier">snums</span>.<span class="ruby-identifier">reverse</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parse_opts</span>[<span class="ruby-identifier">:reverse</span>]&#x000A;    <span class="ruby-identifier">snums</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">scan_num</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ms_levels</span>&#x000A;        <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ms_levels</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">ms_level</span>(<span class="ruby-identifier">scan_num</span>))&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">scan_num</span>, <span class="ruby-identifier">parse_opts</span>))&#x000A;    <span class="ruby-keyword kw">end</span>&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000043'>
                <a name='M000043'></a>
                <div class='synopsis'>
                  <span class='name'>first</span>
                  <span class='arguments'>(opts={})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000043-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000043-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 183</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">first</span>(<span class="ruby-identifier">opts</span>={})&#x000A;    <span class="ruby-identifier">the_first</span> = <span class="ruby-keyword kw">nil</span>&#x000A;    <span class="ruby-identifier">each_scan</span>(<span class="ruby-identifier">opts</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">scan</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">the_first</span> = <span class="ruby-identifier">scan</span>&#x000A;      <span class="ruby-keyword kw">break</span>&#x000A;    <span class="ruby-keyword kw">end</span>&#x000A;    <span class="ruby-identifier">the_first</span>&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000044'>
                <a name='M000044'></a>
                <div class='synopsis'>
                  <span class='name'>last</span>
                  <span class='arguments'>(opts={})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000044-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000044-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 192</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">last</span>(<span class="ruby-identifier">opts</span>={})&#x000A;    <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:reverse</span>] = <span class="ruby-keyword kw">true</span>&#x000A;    <span class="ruby-identifier">first</span>(<span class="ruby-identifier">opts</span>)&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000037'>
                <a name='M000037'></a>
                <div class='synopsis'>
                  <span class='name'>ms_level</span>
                  <span class='arguments'>(num)</span>
                </div>
                <div class='description'>
                  <p>
                  a very fast method to only query the <a
                  href="Msrun.html#M000037">ms_level</a> of a scan
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000037-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000037-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 112</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ms_level</span>(<span class="ruby-identifier">num</span>)&#x000A;    <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">parse_ms_level</span>(<span class="ruby-ivar">@index</span>[<span class="ruby-identifier">num</span>].<span class="ruby-identifier">first</span>, <span class="ruby-ivar">@index</span>[<span class="ruby-identifier">num</span>].<span class="ruby-identifier">last</span>)&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000033'>
                <a name='M000033'></a>
                <div class='synopsis'>
                  <span class='name'>parent_basename_noext</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000033-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000033-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 75</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parent_basename_noext</span>&#x000A;    <span class="ruby-ivar">@parent_basename</span>.<span class="ruby-identifier">chomp</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-ivar">@parent_basename</span>))&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000038'>
                <a name='M000038'></a>
                <div class='synopsis'>
                  <span class='name'>scan</span>
                  <span class='arguments'>(num, parse_opts={})</span>
                </div>
                <div class='description'>
                  <p>
                  returns a Ms::Scan object for the scan at that number
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000038-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000038-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 118</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">num</span>, <span class="ruby-identifier">parse_opts</span>={})&#x000A;    <span class="ruby-comment cmt">#@parser.parse_scan(*(@index[num]), parse_opts)</span>&#x000A;    <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">parse_scan</span>(<span class="ruby-ivar">@index</span>[<span class="ruby-identifier">num</span>].<span class="ruby-identifier">first</span>, <span class="ruby-ivar">@index</span>[<span class="ruby-identifier">num</span>].<span class="ruby-identifier">last</span>, <span class="ruby-identifier">parse_opts</span>)&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000040'>
                <a name='M000040'></a>
                <div class='synopsis'>
                  <span class='name'>scan_count</span>
                  <span class='arguments'>(mslevel=0)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000040-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000040-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 143</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan_count</span>(<span class="ruby-identifier">mslevel</span>=<span class="ruby-value">0</span>)&#x000A;    <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@scan_counts</span>&#x000A;      <span class="ruby-ivar">@scan_counts</span>[<span class="ruby-identifier">mslevel</span>]&#x000A;    <span class="ruby-keyword kw">else</span>&#x000A;      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">mslevel</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>&#x000A;        <span class="ruby-ivar">@scan_count</span> &#x000A;      <span class="ruby-keyword kw">else</span>&#x000A;        <span class="ruby-identifier">scan_counts</span>[<span class="ruby-identifier">mslevel</span>]&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;    <span class="ruby-keyword kw">end</span>&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000039'>
                <a name='M000039'></a>
                <div class='synopsis'>
                  <span class='name'>scan_counts</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  returns an array, whose indices provide the number of scans in each index
                  level the ms_levels, [0] = all the scans, [1] = mslevel 1, [2] = mslevel 2,
                  &#8230;
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000039-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000039-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 128</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan_counts</span>&#x000A;    <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@scan_counts</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@scan_counts</span>&#x000A;    <span class="ruby-identifier">ar</span> = []&#x000A;    <span class="ruby-identifier">ar</span>[<span class="ruby-value">0</span>] = <span class="ruby-value">0</span>&#x000A;    <span class="ruby-identifier">each_scan</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sc</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">level</span> = <span class="ruby-identifier">sc</span>.<span class="ruby-identifier">ms_level</span>&#x000A;      <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ar</span>[<span class="ruby-identifier">level</span>]&#x000A;        <span class="ruby-identifier">ar</span>[<span class="ruby-identifier">level</span>] = <span class="ruby-value">0</span>&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-identifier">ar</span>[<span class="ruby-identifier">level</span>] <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;      <span class="ruby-identifier">ar</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;    <span class="ruby-keyword kw">end</span>&#x000A;    <span class="ruby-ivar">@scan_counts</span> = <span class="ruby-identifier">ar</span>&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000041'>
                <a name='M000041'></a>
                <div class='synopsis'>
                  <span class='name'>start_and_end_mz</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  returns [start_mz, end_mz] for ms level 1 scans or [nil,nil] if unknown
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000041-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000041-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 157</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_and_end_mz</span>&#x000A;    <span class="ruby-identifier">scan</span> = <span class="ruby-identifier">first</span>(<span class="ruby-identifier">:ms_level</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">:spectrum</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:precursor</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>)&#x000A;    [<span class="ruby-identifier">scan</span>.<span class="ruby-identifier">start_mz</span>, <span class="ruby-identifier">scan</span>.<span class="ruby-identifier">end_mz</span>]&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000042'>
                <a name='M000042'></a>
                <div class='synopsis'>
                  <span class='name'>start_and_end_mz_brute_force</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  goes through every scan and gets the first and last m/z, then returns the
                  max.ceil and min.floor
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000042-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000042-source'><span class="ruby-comment cmt"># File lib/ms/msrun.rb, line 164</span>&#x000A;  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_and_end_mz_brute_force</span>&#x000A;    <span class="ruby-identifier">first_scan</span> = <span class="ruby-identifier">first</span>(<span class="ruby-identifier">:ms_level</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">:precursor</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>)&#x000A;    <span class="ruby-identifier">first_mzs</span> = <span class="ruby-identifier">first_scan</span>.<span class="ruby-identifier">spectrum</span>.<span class="ruby-identifier">mzs</span>&#x000A;&#x000A;    <span class="ruby-identifier">lo_mz</span> = <span class="ruby-identifier">first_mzs</span>[<span class="ruby-value">0</span>]&#x000A;    <span class="ruby-identifier">hi_mz</span> = <span class="ruby-identifier">first_mzs</span>[<span class="ruby-value">-1</span>]&#x000A;&#x000A;    <span class="ruby-identifier">each_scan</span>(<span class="ruby-identifier">:ms_level</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">:precursor</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sc</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">mz_ar</span> = <span class="ruby-identifier">sc</span>.<span class="ruby-identifier">spectrum</span>.<span class="ruby-identifier">mzs</span>&#x000A;      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">mz_ar</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hi_mz</span>&#x000A;        <span class="ruby-identifier">hi_mz</span> = <span class="ruby-identifier">mz_ar</span>.<span class="ruby-identifier">last</span>&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">mz_ar</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">lo_mz</span>&#x000A;        <span class="ruby-identifier">lo_mz</span> = <span class="ruby-identifier">mz_ar</span>.<span class="ruby-identifier">last</span>&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;    <span class="ruby-keyword kw">end</span>&#x000A;    [<span class="ruby-identifier">lo_mz</span>.<span class="ruby-identifier">floor</span>, <span class="ruby-identifier">hi_mz</span>.<span class="ruby-identifier">ceil</span>]&#x000A;  <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
